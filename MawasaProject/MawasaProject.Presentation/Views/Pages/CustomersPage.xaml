<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MawasaProject.Presentation.Views.Pages.CustomersPage"
             Title="Customers"
             Shell.NavBarIsVisible="False"
             BackgroundColor="#E9EDF3">
    <ContentPage.Resources>
        <Color x:Key="SurfaceCard">#FFFFFF</Color>
        <Color x:Key="SurfaceSection">#F7F9FC</Color>
        <Color x:Key="TextMain">#1F2A37</Color>
        <Color x:Key="TextMuted">#6F8093</Color>
        <Color x:Key="BorderSoft">#D9E2EC</Color>
        <Color x:Key="BorderStrong">#C6D4E3</Color>
        <Color x:Key="PrimaryBlue">#2D6DE2</Color>
        <Style x:Key="FieldLabelStyle" TargetType="Label">
            <Setter Property="FontSize" Value="11" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="TextColor" Value="#60758C" />
        </Style>
        <Style x:Key="HelperTextStyle" TargetType="Label">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="TextColor" Value="{StaticResource TextMuted}" />
        </Style>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="16,14,16,24" Spacing="14">
            <VerticalStackLayout IsVisible="{Binding IsRegisterMode}" Spacing="12">
                <Grid ColumnDefinitions="*,Auto">
                    <Label Text="New Customer Registration"
                           FontSize="35"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextMain}" />
                    <Label Grid.Column="1"
                           Text="Step 1 of 2"
                           FontSize="12"
                           TextColor="{StaticResource TextMuted}"
                           VerticalTextAlignment="Center" />
                </Grid>

                <Border BackgroundColor="{StaticResource SurfaceCard}" Stroke="{StaticResource BorderSoft}" StrokeThickness="1" Padding="16,14">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="14" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Fill the steps below. ID verification is required before any meter can be installed."
                               Style="{StaticResource HelperTextStyle}" />

                        <Border BackgroundColor="{StaticResource SurfaceSection}" Stroke="{StaticResource BorderSoft}" StrokeThickness="1" Padding="14,12">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12" />
                            </Border.StrokeShape>
                            <VerticalStackLayout Spacing="8">
                                <Grid ColumnDefinitions="*,Auto">
                                    <VerticalStackLayout Spacing="2">
                                        <Label Text="APPLICANT DETAILS" FontSize="20" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                                        <Label Text="Basic information for identifying the new customer." Style="{StaticResource HelperTextStyle}" />
                                    </VerticalStackLayout>
                                    <Label Grid.Column="1"
                                           Text="REQUIRED SECTION"
                                           FontSize="11"
                                           FontAttributes="Bold"
                                           TextColor="#2D6DE2"
                                           VerticalTextAlignment="Center" />
                                </Grid>

                                <Grid ColumnDefinitions="{OnIdiom Phone='*', Tablet='*,*', Desktop='*,*'}"
                                      RowDefinitions="{OnIdiom Phone='Auto,Auto', Tablet='Auto', Desktop='Auto'}"
                                      ColumnSpacing="10"
                                      RowSpacing="10">
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="First Name" Style="{StaticResource FieldLabelStyle}" />
                                        <Border BackgroundColor="White" Stroke="{StaticResource BorderStrong}" StrokeThickness="1" Padding="10,0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Entry Text="{Binding RegistrationFirstName}" />
                                        </Border>
                                    </VerticalStackLayout>

                                    <VerticalStackLayout Grid.Column="{OnIdiom Phone=0, Tablet=1, Desktop=1}"
                                                         Grid.Row="{OnIdiom Phone=1, Tablet=0, Desktop=0}"
                                                         Spacing="4">
                                        <Label Text="Last Name" Style="{StaticResource FieldLabelStyle}" />
                                        <Border BackgroundColor="White" Stroke="{StaticResource BorderStrong}" StrokeThickness="1" Padding="10,0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Entry Text="{Binding RegistrationLastName}" />
                                        </Border>
                                    </VerticalStackLayout>
                                </Grid>
                            </VerticalStackLayout>
                        </Border>

                        <Border BackgroundColor="{StaticResource SurfaceSection}" Stroke="{StaticResource BorderSoft}" StrokeThickness="1" Padding="14,12">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12" />
                            </Border.StrokeShape>
                            <VerticalStackLayout Spacing="8">
                                <Grid ColumnDefinitions="*,Auto">
                                    <VerticalStackLayout Spacing="2">
                                        <Label Text="SERVICE ADDRESS" FontSize="20" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                                        <Label Text="Provide the full location where the service will be installed." Style="{StaticResource HelperTextStyle}" />
                                    </VerticalStackLayout>
                                    <Label Grid.Column="1"
                                           Text="Optional fields help us locate the property faster."
                                           FontSize="11"
                                           TextColor="{StaticResource TextMuted}"
                                           VerticalTextAlignment="Center" />
                                </Grid>

                                <Grid ColumnDefinitions="{OnIdiom Phone='*', Tablet='*,*,*', Desktop='*,*,*'}"
                                      RowDefinitions="{OnIdiom Phone='Auto,Auto,Auto', Tablet='Auto', Desktop='Auto'}"
                                      ColumnSpacing="10"
                                      RowSpacing="10">
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="Barangay" Style="{StaticResource FieldLabelStyle}" />
                                        <Border BackgroundColor="White" Stroke="{StaticResource BorderStrong}" StrokeThickness="1" Padding="10,0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Entry Text="{Binding RegistrationBarangay}" />
                                        </Border>
                                    </VerticalStackLayout>

                                    <VerticalStackLayout Grid.Column="{OnIdiom Phone=0, Tablet=1, Desktop=1}"
                                                         Grid.Row="{OnIdiom Phone=1, Tablet=0, Desktop=0}"
                                                         Spacing="4">
                                        <Label Text="City / Municipality" Style="{StaticResource FieldLabelStyle}" />
                                        <Border BackgroundColor="White" Stroke="{StaticResource BorderStrong}" StrokeThickness="1" Padding="10,0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Entry Text="{Binding RegistrationCityMunicipality}" />
                                        </Border>
                                    </VerticalStackLayout>

                                    <VerticalStackLayout Grid.Column="{OnIdiom Phone=0, Tablet=2, Desktop=2}"
                                                         Grid.Row="{OnIdiom Phone=2, Tablet=0, Desktop=0}"
                                                         Spacing="4">
                                        <Label Text="Province" Style="{StaticResource FieldLabelStyle}" />
                                        <Border BackgroundColor="White" Stroke="{StaticResource BorderStrong}" StrokeThickness="1" Padding="10,0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Entry Text="{Binding RegistrationProvince}" />
                                        </Border>
                                    </VerticalStackLayout>
                                </Grid>

                                <Grid ColumnDefinitions="{OnIdiom Phone='*', Tablet='*,*,*', Desktop='*,*,*'}"
                                      RowDefinitions="{OnIdiom Phone='Auto,Auto,Auto', Tablet='Auto', Desktop='Auto'}"
                                      ColumnSpacing="10"
                                      RowSpacing="10">
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="Street / Block &amp; Lot (optional)" Style="{StaticResource FieldLabelStyle}" />
                                        <Border BackgroundColor="White" Stroke="{StaticResource BorderStrong}" StrokeThickness="1" Padding="10,0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Entry Placeholder="e.g. Mabini St, Blk 3 Lot 12"
                                                   Text="{Binding RegistrationStreetBlockLot}" />
                                        </Border>
                                    </VerticalStackLayout>

                                    <VerticalStackLayout Grid.Column="{OnIdiom Phone=0, Tablet=1, Desktop=1}"
                                                         Grid.Row="{OnIdiom Phone=1, Tablet=0, Desktop=0}"
                                                         Spacing="4">
                                        <Label Text="Purok" Style="{StaticResource FieldLabelStyle}" />
                                        <Border BackgroundColor="White" Stroke="{StaticResource BorderStrong}" StrokeThickness="1" Padding="10,0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Picker ItemsSource="{Binding PurokOptions}"
                                                    SelectedItem="{Binding RegistrationSelectedPurok}" />
                                        </Border>
                                    </VerticalStackLayout>

                                    <VerticalStackLayout Grid.Column="{OnIdiom Phone=0, Tablet=2, Desktop=2}"
                                                         Grid.Row="{OnIdiom Phone=2, Tablet=0, Desktop=0}"
                                                         Spacing="4">
                                        <Label Text="Postal Code (optional)" Style="{StaticResource FieldLabelStyle}" />
                                        <Border BackgroundColor="White" Stroke="{StaticResource BorderStrong}" StrokeThickness="1" Padding="10,0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Entry Placeholder="e.g. 4271"
                                                   Text="{Binding RegistrationPostalCode}" />
                                        </Border>
                                    </VerticalStackLayout>
                                </Grid>
                            </VerticalStackLayout>
                        </Border>

                        <Border BackgroundColor="{StaticResource SurfaceSection}" Stroke="{StaticResource BorderSoft}" StrokeThickness="1" Padding="14,12">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12" />
                            </Border.StrokeShape>
                            <VerticalStackLayout Spacing="8">
                                <Label Text="CONTACT DETAILS" FontSize="20" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                                <Label Text="We'll reach out using this information for updates and verification."
                                       Style="{StaticResource HelperTextStyle}" />

                                <VerticalStackLayout Spacing="4" WidthRequest="{OnIdiom Phone=-1, Tablet=650, Desktop=650}">
                                    <Label Text="Contact Number (optional)" Style="{StaticResource FieldLabelStyle}" />
                                    <Border BackgroundColor="White" Stroke="{StaticResource BorderStrong}" StrokeThickness="1" Padding="10,0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="8" />
                                        </Border.StrokeShape>
                                        <Entry Placeholder="e.g. 09XX-XXX-XXXX"
                                               Text="{Binding RegistrationContactNumber}" />
                                    </Border>
                                </VerticalStackLayout>
                            </VerticalStackLayout>
                        </Border>

                        <Grid ColumnDefinitions="Auto,*,Auto" Margin="0,4,0,0">
                            <Button Text="Back"
                                    Clicked="OnRegisterBackClicked"
                                    BackgroundColor="#EDF2FA"
                                    TextColor="#8293A8"
                                    Padding="16,10" />
                            <Button Grid.Column="2"
                                    Text="Next"
                                    Command="{Binding RegisterCustomerCommand}"
                                    BackgroundColor="{StaticResource PrimaryBlue}"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    Padding="22,10" />
                        </Grid>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>

            <VerticalStackLayout IsVisible="{Binding IsManagementMode}" Spacing="14">
            <Border BackgroundColor="{StaticResource SurfaceCard}" Stroke="{StaticResource BorderSoft}" StrokeThickness="1" Padding="14,12">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="14" />
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="10">
                    <VerticalStackLayout Spacing="2">
                        <Label Text="Customers" FontSize="36" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                        <Label Text="Manage customer records and meter/account details."
                               Style="{StaticResource HelperTextStyle}" />
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="{OnIdiom Phone='*', Tablet='3.2*,Auto,Auto,Auto,Auto', Desktop='3.2*,Auto,Auto,Auto,Auto'}"
                          RowDefinitions="{OnIdiom Phone='Auto,Auto,Auto,Auto,Auto', Tablet='Auto', Desktop='Auto'}"
                          ColumnSpacing="8"
                          RowSpacing="8">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Search" Style="{StaticResource FieldLabelStyle}" />
                            <Border BackgroundColor="White" Stroke="{StaticResource BorderStrong}" StrokeThickness="1" Padding="10,0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8" />
                                </Border.StrokeShape>
                                <Entry Placeholder="Type to filter rows..."
                                       Text="{Binding SearchQuery}" />
                            </Border>
                        </VerticalStackLayout>

                        <Label Grid.Column="{OnIdiom Phone=0, Tablet=1, Desktop=1}"
                               Grid.Row="{OnIdiom Phone=1, Tablet=0, Desktop=0}"
                               Text="Sort"
                               FontAttributes="Bold"
                               TextColor="#61768C"
                               VerticalTextAlignment="End"
                               Margin="0,0,0,8" />

                        <Border Grid.Column="{OnIdiom Phone=0, Tablet=2, Desktop=2}"
                                Grid.Row="{OnIdiom Phone=2, Tablet=0, Desktop=0}"
                                BackgroundColor="White"
                                Stroke="{StaticResource BorderStrong}"
                                StrokeThickness="1"
                                Padding="10,0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <Picker ItemsSource="{Binding SortColumns}"
                                    SelectedItem="{Binding SelectedSortColumn}" />
                        </Border>

                        <Border Grid.Column="{OnIdiom Phone=0, Tablet=3, Desktop=3}"
                                Grid.Row="{OnIdiom Phone=3, Tablet=0, Desktop=0}"
                                BackgroundColor="White"
                                Stroke="{StaticResource BorderStrong}"
                                StrokeThickness="1"
                                Padding="10,0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <Picker ItemsSource="{Binding SortDirections}"
                                    SelectedItem="{Binding SelectedSortDirection}" />
                        </Border>

                        <Button Grid.Column="{OnIdiom Phone=0, Tablet=4, Desktop=4}"
                                Grid.Row="{OnIdiom Phone=4, Tablet=0, Desktop=0}"
                                Text="Apply"
                                Command="{Binding SearchCommand}"
                                FontAttributes="Bold"
                                BackgroundColor="{StaticResource PrimaryBlue}"
                                TextColor="White"
                                Padding="18,10"
                                VerticalOptions="End" />
                    </Grid>

                    <ScrollView Orientation="Horizontal">
                        <VerticalStackLayout WidthRequest="1150" Spacing="0">
                            <Grid ColumnDefinitions="0.6*,1.4*,2*,3.3*,1.5*,1.7*,1.5*,1.3*"
                                  BackgroundColor="#1F67D7"
                                  Padding="10,8">
                                <Label Text="" />
                                <Label Grid.Column="1" Text="ACCOUNT NO." FontSize="10" FontAttributes="Bold" TextColor="White" />
                                <Label Grid.Column="2" Text="NAME" FontSize="10" FontAttributes="Bold" TextColor="White" />
                                <Label Grid.Column="3" Text="ADDRESS" FontSize="10" FontAttributes="Bold" TextColor="White" />
                                <Label Grid.Column="4" Text="APPLICATION" FontSize="10" FontAttributes="Bold" TextColor="White" />
                                <Label Grid.Column="5" Text="CONTACT NO." FontSize="10" FontAttributes="Bold" TextColor="White" />
                                <Label Grid.Column="6" Text="STATUS" FontSize="10" FontAttributes="Bold" TextColor="White" />
                                <Label Grid.Column="7" Text="CREATED" FontSize="10" FontAttributes="Bold" TextColor="White" />
                            </Grid>

                            <CollectionView ItemsSource="{Binding Customers}"
                                            SelectionMode="None"
                                            HeightRequest="470">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="0.6*,1.4*,2*,3.3*,1.5*,1.7*,1.5*,1.3*"
                                              Padding="10,9"
                                              ColumnSpacing="8"
                                              BackgroundColor="{Binding RowBackground}">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="1" />
                                            </Grid.RowDefinitions>

                                            <CheckBox IsChecked="False"
                                                      IsEnabled="False"
                                                      VerticalOptions="Center"
                                                      Color="#BCC8D8" />

                                            <Label Grid.Column="1"
                                                   Text="{Binding AccountNumber}"
                                                   FontSize="12"
                                                   TextColor="#20354A"
                                                   VerticalTextAlignment="Center" />
                                            <Label Grid.Column="2"
                                                   Text="{Binding Name}"
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="#20354A"
                                                   VerticalTextAlignment="Center" />
                                            <Label Grid.Column="3"
                                                   Text="{Binding Address}"
                                                   FontSize="12"
                                                   TextColor="#41556D"
                                                   LineBreakMode="TailTruncation"
                                                   VerticalTextAlignment="Center" />

                                            <Border Grid.Column="4"
                                                    BackgroundColor="{Binding ApplicationBackground}"
                                                    StrokeThickness="0"
                                                    Padding="8,4"
                                                    HorizontalOptions="Start"
                                                    VerticalOptions="Center">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="10" />
                                                </Border.StrokeShape>
                                                <Label Text="{Binding ApplicationText}"
                                                       FontSize="11"
                                                       FontAttributes="Bold"
                                                       TextColor="{Binding ApplicationForeground}" />
                                            </Border>

                                            <Label Grid.Column="5"
                                                   Text="{Binding ContactNumber}"
                                                   FontSize="12"
                                                   TextColor="#41556D"
                                                   VerticalTextAlignment="Center" />

                                            <Border Grid.Column="6"
                                                    BackgroundColor="{Binding StatusBackground}"
                                                    StrokeThickness="0"
                                                    Padding="8,4"
                                                    HorizontalOptions="Start"
                                                    VerticalOptions="Center">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="10" />
                                                </Border.StrokeShape>
                                                <Label Text="{Binding StatusText}"
                                                       FontSize="11"
                                                       FontAttributes="Bold"
                                                       TextColor="{Binding StatusForeground}" />
                                            </Border>

                                            <Label Grid.Column="7"
                                                   Text="{Binding CreatedDisplay}"
                                                   FontSize="12"
                                                   TextColor="#41556D"
                                                   VerticalTextAlignment="Center" />

                                            <BoxView Grid.Row="1"
                                                     Grid.ColumnSpan="8"
                                                     HeightRequest="1"
                                                     Color="#E2EAF4"
                                                     Margin="0,9,0,0" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </ScrollView>

                    <Grid ColumnDefinitions="*,Auto,Auto,Auto" ColumnSpacing="8" VerticalOptions="Center">
                        <Label Text="{Binding ResultSummary}"
                               TextColor="{StaticResource TextMuted}"
                               VerticalTextAlignment="Center" />
                        <Button Grid.Column="1"
                                Text="Previous"
                                Command="{Binding PreviousPageCommand}"
                                IsEnabled="{Binding CanGoPreviousPage}"
                                BackgroundColor="#EEF3FB"
                                TextColor="#41556D"
                                FontAttributes="Bold" />
                        <Label Grid.Column="2"
                               Text="{Binding PageSummary}"
                               VerticalTextAlignment="Center"
                               FontAttributes="Bold"
                               TextColor="#2A3F56"
                               Margin="8,0" />
                        <Button Grid.Column="3"
                                Text="Next"
                                Command="{Binding NextPageCommand}"
                                IsEnabled="{Binding CanGoNextPage}"
                                BackgroundColor="#EEF3FB"
                                TextColor="#41556D"
                                FontAttributes="Bold" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <Border BackgroundColor="{StaticResource SurfaceCard}" Stroke="{StaticResource BorderSoft}" StrokeThickness="1" Padding="14,12">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="14" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="8">
                    <Label Text="Quick Add Customer" FontSize="20" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                    <Grid ColumnDefinitions="{OnIdiom Phone='*', Tablet='1.2*,1*,1*,1.3*', Desktop='1.2*,1*,1*,1.3*'}"
                          RowDefinitions="{OnIdiom Phone='Auto,Auto,Auto,Auto', Tablet='Auto', Desktop='Auto'}"
                          ColumnSpacing="8"
                          RowSpacing="8">
                        <Entry Placeholder="Customer name"
                               Text="{Binding Name}" />
                        <Entry Grid.Column="{OnIdiom Phone=0, Tablet=1, Desktop=1}"
                               Grid.Row="{OnIdiom Phone=1, Tablet=0, Desktop=0}"
                               Placeholder="Phone no."
                               Text="{Binding Phone}" />
                        <Entry Grid.Column="{OnIdiom Phone=0, Tablet=2, Desktop=2}"
                               Grid.Row="{OnIdiom Phone=2, Tablet=0, Desktop=0}"
                               Placeholder="Email"
                               Text="{Binding Email}" />
                        <Entry Grid.Column="{OnIdiom Phone=0, Tablet=3, Desktop=3}"
                               Grid.Row="{OnIdiom Phone=3, Tablet=0, Desktop=0}"
                               Placeholder="Address"
                               Text="{Binding Address}" />
                    </Grid>
                    <Button Text="Add Customer"
                            Command="{Binding AddCustomerCommand}"
                            FontAttributes="Bold"
                            BackgroundColor="{StaticResource PrimaryBlue}"
                            TextColor="White"
                            HorizontalOptions="End" />
                </VerticalStackLayout>
            </Border>
            </VerticalStackLayout>

            <Label Text="{Binding StatusMessage}" FontSize="12" TextColor="{StaticResource TextMuted}" />
            <Label Text="{Binding ErrorMessage}" FontSize="12" TextColor="#C12424" IsVisible="{Binding HasErrors}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
